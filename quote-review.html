<section class="panel">
  <h2>Quote Preview</h2>
  <div id="qwrap" class="card">Loading…</div>
</section>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // reuse same env style
  const SUPABASE_URL = 'https://yikxwceipqtxjarcnxdr.supabase.co';   // <-- replace
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlpa3h3Y2VpcHF0eGphcmNueGRyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ3NzkyMTIsImV4cCI6MjA3MDM1NTIxMn0.PmvRyNucXrOMXcwsXIWAaK6pfia0bzEXUw53cHEhFqI';                  // <-- replace
  const supa = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const params = new URLSearchParams(location.search);
  const id = params.get('quoteId');

  async function loadQuote() {
    if (!id) { document.getElementById('qwrap').textContent = 'No quoteId provided.'; return; }

    const { data: quote, error } = await supa
      .from('quotes')
      .select('id, total, base_fee, rate_lawn, rate_drive, lawn_sqft, drive_m, status, property_id')
      .eq('id', id)
      .single();
    if (error) { document.getElementById('qwrap').textContent = 'Error: ' + error.message; return; }

    const { data: prop } = await supa
      .from('properties')
      .select('address')
      .eq('id', quote.property_id)
      .single();

    document.getElementById('qwrap').innerHTML = `
      <h3>${prop?.address || 'Property'}</h3>
      <div class="hr"></div>
      <table class="table">
        <tr><th>Item</th><th>Qty</th><th>Rate</th><th>Total</th></tr>
        <tr><td>Lawn mow (${(quote.lawn_sqft||0).toLocaleString()} sqft)</td><td>1</td><td>$${quote.rate_lawn}/sqft</td><td>$${(quote.lawn_sqft*quote.rate_lawn).toFixed(2)}</td></tr>
        <tr><td>Driveway blow-off (${(quote.drive_m||0).toLocaleString()} m)</td><td>1</td><td>$${quote.rate_drive}/m</td><td>$${(quote.drive_m*quote.rate_drive).toFixed(2)}</td></tr>
        <tr><td>Base fee</td><td>1</td><td>—</td><td>$${(quote.base_fee||0).toFixed(2)}</td></tr>
        <tr><th colspan="3" style="text-align:right">Total</th><th>$${Number(quote.total||0).toFixed(2)}</th></tr>
      </table>
      <div class="row" style="margin-top:8px">
        <button class="btn primary" onclick="alert('Simulated approval'); location.href='jobs.html'">Approve & Create Job</button>
        <button class="btn" onclick="history.back()">Edit</button>
      </div>
    `;
  }
  loadQuote();
</script>
